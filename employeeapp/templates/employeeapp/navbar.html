{% load profile_tags %}

<nav class="navbar">
    <div class="navbar-brand">Employee App</div>
    <div class="navbar-toggle" id="mobile-menu">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
    </div>
    <ul class="navbar-menu">
        {% if user.is_authenticated %}
        <li class="navbar-item">
            <span class="logged-in-name">
                Logged in as {{ user.username }} 
            </span>
            </li>
        <li class="navbar-item dropdown">
            <a href="#" class="dropdown-toggle" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                Profile
            </a>
            <ul class="dropdown-menu dropdown-color" aria-labelledby="profileDropdown">
                {% get_user_profile user as profile %}
                {% if profile %}
                    <!-- Profile exists -->
                    <div class="dropdown-color">
                        <li><a class="dropdown-item" href="{% url 'edit_profile' pk=profile.pk %}">Edit Profile</a></li>
                    </div>
                    <div class="dropdown-color">
                        <li><a class="dropdown-item" href="{% url 'profile_detail' pk=profile.pk %}">View Profile</a></li>
                    </div>
                {% else %}
                    <!-- Profile does not exist -->
                    <li>
                        <div class="dropdown-color">
                            <a class="dropdown-item" href="{% url 'create_profile' %}">Create Profile</a>
                        </div>
                    </li>
                {% endif %}
            </ul>
        </li>
        <li class="navbar-item"><a href="{% url 'employee-clockin' %}">Clock-in</a></li>
        <li class="navbar-item"><a href="{% url 'employee-clockin' %}">Hours</a></li>
        <li class="navbar-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="navbar-item"><a href="{% url 'add-job' %}">Add Job</a></li>
        <li class="navbar-item"><a href="{% url 'logout' %}">Logout</a></li>
        {% else %}
        <li class="navbar-item"><a href="{% url 'login' %}">Login</a></li>
        <li class="navbar-item"><a href="{% url 'register' %}">Register</a></li>
        {% endif %}
    </ul>
</nav>

    <script>
        const mobileMenu = document.getElementById('mobile-menu');
        const navbarMenu = document.querySelector('.navbar-menu');

        mobileMenu.addEventListener('click', () => {
            navbarMenu.classList.toggle('active');
        });

            // Automatically dismiss alerts after 4 seconds
        window.addEventListener('load', function() {
            var alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    var bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();

                    // Add event listener to handle when alert is fully closed
                    alert.addEventListener('closed.bs.alert', function () {
                        var container = alert.parentElement;

                        // Check if there are any remaining alerts in the container
                        if (container.querySelectorAll('.alert').length === 0) {
                            // Add a class to hide the container
                            container.classList.add('d-none');
                        }
                    });

                }, 4000);
            });
        });

    </script>
